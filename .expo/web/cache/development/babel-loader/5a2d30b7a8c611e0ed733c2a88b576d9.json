{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"/Users/thadz/Desktop/SunSavings/fixedProfileAndTransfer/pnmobileapp/src/screens/OTP/OTPBankAccount.js\";\nimport React, { useEffect, useState } from \"react\";\nimport PropTypes from \"prop-types\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport { connect } from \"react-redux\";\nimport { ModifiedOTP } from \"./ModifiedOTP\";\nimport { OTP, profile } from \"../../API\";\nexport var OTPBankAccount = function OTPBankAccount(props) {\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      isLoading = _useState2[0],\n      setLoadingState = _useState2[1];\n\n  var _useState3 = useState(\"\"),\n      _useState4 = _slicedToArray(_useState3, 2),\n      loadingText = _useState4[0],\n      setLoadingText = _useState4[1];\n\n  var _useState5 = useState(null),\n      _useState6 = _slicedToArray(_useState5, 2),\n      token = _useState6[0],\n      setToken = _useState6[1];\n\n  var auth = props.auth,\n      navigation = props.navigation,\n      params = props.route.params;\n  useEffect(function () {\n    if (!params.formData) {\n      Alert.alert(\"Failed\", \"You need to fill-up the Edit Mobile Number form first.\", [{\n        text: \"Ok\",\n        onPress: handleBack\n      }]);\n    } else {\n      handleRequestOTP();\n    }\n  }, [params == null ? void 0 : params.formData]);\n\n  var handleRequestOTP = function handleRequestOTP() {\n    var _params$formData, _params$formData2;\n\n    OTP.request({\n      mobileNumber: params == null ? void 0 : (_params$formData = params.formData) == null ? void 0 : _params$formData.phoneNumber\n    }, {\n      mobileNumber: params == null ? void 0 : (_params$formData2 = params.formData) == null ? void 0 : _params$formData2.phoneNumber\n    }).then(function (_ref) {\n      var _ref$data = _ref.data,\n          message = _ref$data.msg,\n          status = _ref$data.status,\n          token = _ref$data.token;\n\n      if (token) {\n        setToken(token);\n        return true;\n      }\n\n      Alert.alert(\"Invalid Phone Number\", message, [{\n        text: \"Retry\",\n        onPress: function onPress() {\n          return handleRequestOTP();\n        }\n      }, {\n        text: \"Cancel\",\n        onPress: handleBack,\n        style: \"cancel\"\n      }]);\n    }).catch(function (error) {\n      Alert.alert(\"Server Error\", \"Ooops! There's something wrong connecting to the server. Please try again.\");\n    });\n    return false;\n  };\n\n  var handleBack = function handleBack() {\n    navigation.goBack();\n  };\n\n  var handleSaveBankAccount = function handleSaveBankAccount() {\n    var _params$formData3;\n\n    setLoadingState(true);\n    setLoadingText(\"Updating Mobile Number\");\n    profile.addAttribute({\n      accessToken: auth.accessToken,\n      attributeName: \"phoneNumber\",\n      attributeValue: params == null ? void 0 : (_params$formData3 = params.formData) == null ? void 0 : _params$formData3.phoneNumber\n    }).then(function (_ref2) {\n      var _ref2$data = _ref2.data,\n          success = _ref2$data.success,\n          message = _ref2$data.message;\n\n      if (success) {\n        Alert.alert(\"Change Mobile Number\", \"Mobile Number was successfully changed.\", [{\n          text: \"Ok\",\n          onPress: function onPress() {\n            return navigation.navigate(\"ViewProfile\", {\n              reload: true\n            });\n          }\n        }]);\n      } else {\n        Alert.alert(\"Change Mobile Number\", \"Failed while changing mobile number\", [{\n          text: \"Retry\",\n          onPress: function onPress() {\n            return handleSaveBankAccount();\n          }\n        }, {\n          text: \"Cancel\",\n          onPress: handleBack,\n          style: \"cancel\"\n        }]);\n      }\n    }).catch(function (error) {\n      Alert.alert(\"Server Error\", \"Ooops! There's something wrong connecting to the server. Please try again.\");\n    }).finally(function () {\n      return setLoadingState(false);\n    });\n  };\n\n  var handleDone = function handleDone(code) {\n    setLoadingState(true);\n    setLoadingText(\"Verifying OTP Code\");\n    OTP.verify(code, token).then(function (_ref3) {\n      var data = _ref3.data.data;\n      var message = data.message,\n          status = data.status;\n\n      if (status === \"ok\") {\n        handleSaveBankAccount();\n      } else {\n        Alert.alert(\"Mismatch Token and Code\", \"The OTP you entered is invalid. Please try again.\");\n      }\n    }).catch(function (error) {\n      Alert.alert(\"Server Error\", \"Ooops! There's something wrong connecting to the server. Please try again.\");\n    }).finally(function () {\n      return setLoadingState(false);\n    });\n  };\n\n  return React.createElement(ModifiedOTP, {\n    onDone: handleDone,\n    isLoading: isLoading,\n    loadingText: loadingText,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 5\n    }\n  });\n};\nOTPBankAccount.propTypes = {};\n\nvar mapStateToProps = function mapStateToProps(props) {\n  return {};\n};\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return {};\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(OTPBankAccount);","map":{"version":3,"sources":["/Users/thadz/Desktop/SunSavings/fixedProfileAndTransfer/pnmobileapp/src/screens/OTP/OTPBankAccount.js"],"names":["React","useEffect","useState","PropTypes","connect","ModifiedOTP","OTP","profile","OTPBankAccount","props","isLoading","setLoadingState","loadingText","setLoadingText","token","setToken","auth","navigation","params","route","formData","Alert","alert","text","onPress","handleBack","handleRequestOTP","request","mobileNumber","phoneNumber","then","data","message","msg","status","style","catch","error","goBack","handleSaveBankAccount","addAttribute","accessToken","attributeName","attributeValue","success","navigate","reload","finally","handleDone","code","verify","propTypes","mapStateToProps","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { Alert } from \"react-native\";\nimport { connect } from \"react-redux\";\nimport { ModifiedOTP } from \"./ModifiedOTP\";\n\n// Others\nimport { OTP, profile } from \"../../API\";\n\nexport const OTPBankAccount = (props) => {\n  const [isLoading, setLoadingState] = useState(false);\n  const [loadingText, setLoadingText] = useState(\"\");\n  const [token, setToken] = useState(null);\n  const {\n    auth,\n    navigation,\n    route: { params },\n  } = props;\n\n  useEffect(() => {\n    if (!params.formData) {\n      Alert.alert(\n        \"Failed\",\n        \"You need to fill-up the Edit Mobile Number form first.\",\n        [\n          {\n            text: \"Ok\",\n            onPress: handleBack,\n          },\n        ]\n      );\n    } else {\n      handleRequestOTP();\n    }\n  }, [params?.formData]);\n\n  // useEffect(() => {\n  //   navigation.addListener(\"beforeRemove\", (e) => {\n  //     e.preventDefault();\n  //     handleBack();\n  //   });\n  // }, [navigation, params?.formData]);\n\n  const handleRequestOTP = () => {\n    OTP.request(\n      {\n        mobileNumber: params?.formData?.phoneNumber,\n      },\n      {\n        mobileNumber: params?.formData?.phoneNumber,\n      }\n    )\n      .then(({ data: { msg: message, status, token } }) => {\n        if (token) {\n          setToken(token);\n          return true;\n        }\n\n        Alert.alert(\"Invalid Phone Number\", message, [\n          {\n            text: \"Retry\",\n            onPress: () => handleRequestOTP(),\n          },\n          {\n            text: \"Cancel\",\n            onPress: handleBack,\n            style: \"cancel\",\n          },\n        ]);\n      })\n      .catch((error) => {\n        Alert.alert(\n          \"Server Error\",\n          \"Ooops! There's something wrong connecting to the server. Please try again.\"\n        );\n      });\n\n    return false;\n  };\n\n  const handleBack = () => {\n    navigation.goBack();\n  };\n\n  const handleSaveBankAccount = () => {\n    setLoadingState(true);\n    setLoadingText(\"Updating Mobile Number\");\n    profile\n      .addAttribute({\n        accessToken: auth.accessToken,\n        attributeName: \"phoneNumber\",\n        attributeValue: params?.formData?.phoneNumber,\n      })\n      .then(({ data: { success, message } }) => {\n        if (success) {\n          Alert.alert(\n            \"Change Mobile Number\",\n            \"Mobile Number was successfully changed.\",\n            [\n              {\n                text: \"Ok\",\n                onPress: () =>\n                  navigation.navigate(\"ViewProfile\", { reload: true }),\n              },\n            ]\n          );\n        } else {\n          Alert.alert(\n            \"Change Mobile Number\",\n            \"Failed while changing mobile number\",\n            [\n              {\n                text: \"Retry\",\n                onPress: () => handleSaveBankAccount(),\n              },\n              {\n                text: \"Cancel\",\n                onPress: handleBack,\n                style: \"cancel\",\n              },\n            ]\n          );\n        }\n      })\n      .catch((error) => {\n        Alert.alert(\n          \"Server Error\",\n          \"Ooops! There's something wrong connecting to the server. Please try again.\"\n        );\n      })\n      .finally(() => setLoadingState(false));\n  };\n\n  const handleDone = (code) => {\n    setLoadingState(true);\n    setLoadingText(\"Verifying OTP Code\");\n    OTP.verify(code, token)\n      .then(({ data: { data } }) => {\n        const { message, status } = data;\n        if (status === \"ok\") {\n          handleSaveBankAccount();\n        } else {\n          Alert.alert(\n            \"Mismatch Token and Code\",\n            \"The OTP you entered is invalid. Please try again.\"\n          );\n        }\n      })\n      .catch((error) => {\n        Alert.alert(\n          \"Server Error\",\n          \"Ooops! There's something wrong connecting to the server. Please try again.\"\n        );\n      })\n      .finally(() => setLoadingState(false));\n  };\n\n  return (\n    <ModifiedOTP\n      onDone={handleDone}\n      isLoading={isLoading}\n      loadingText={loadingText}\n    />\n  );\n};\n\nOTPBankAccount.propTypes = {};\n\nconst mapStateToProps = (props) => ({});\n\nconst mapDispatchToProps = (dispatch) => {\n  return {};\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(OTPBankAccount);\n"]},"metadata":{},"sourceType":"module"}